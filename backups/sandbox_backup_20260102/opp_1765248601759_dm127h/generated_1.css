const express = require('express');
const cors = require('cors'); // For cross origin requests support if necessary
require('dotenv').config(); // Assuming we are using dotenv for environment variables management

// Import the required services and models from separate files/modules
const apiRoutes = require('./routes/api'); // API routes file (e.g., ./routes/api.js)
const { Sequelize } = require('sequelize-typescript');
require('../config/database').init(); // Initializes Neon PostgreSQL database with ORM setup if needed
const sequelizeInstance = new Sequelize(process.env.DB_CONNECTION, process.env.SECRET_KEY);

// Initialize Express App and middleware
const app = express();
app.use(express.json()); // Middleware for parsing JSON bodies of requests/responses
if (process.env.CORS) {
  app.use(cors({ origin: process.env.ALLOWED_ORIGINS })); // CORS support if needed, using environment variables or a config file like 'dotenv'. Replace with your preferred approach for managing constants and configurations in codebases these days. Ensure this is done securely without exposing sensitive information to the public API
} else {
  app.use((req, res, next) => {
    // Fallback if CORS not set via environment variables or config file (e.g., 'dotenv')
    next();
  });
}
app.use('/api/v1', apiRoutes); // Mount our API routes on this path

// Start the server with a given port from an environmental variable, defaulting to standard HTTP if not set. Replace `'constants'` module as needed for proper environment management in your codebase (e.g., using 'dotenv' or another configuration library). Ensure security best practices are followed when handling sensitive information like database passwords and API keys
app.listen(process.env.PORT || 3000, () => console.log(`Server is running on http://localhost:${process.env.PORT}`));